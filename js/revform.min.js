(function(a) {
    a.fn.revform = function(e) {
        var n = this,
            q = 0,
            s = {
                next: "Next",
                previous: "Previous",
                submit: "Submit",
                transition: "fade",
                speed: 500,
                validate: false,
                progressBar: false,
                showProgressText: false,
            },
            d = n.find("fieldset"),
            j, v, r, m, g = 0,
            o = d.length,
            k = 100,
            f, c, p;
        if (e) {
            a.extend(s, e)
        }
        if (s.progressBar) {
            g = t()
        }
        n.append('<div class="form-controls"><input type="button" value="' + s.previous + '" class="previous-fieldset rev-form-button btn btn-orange " /><input  type="button" value="' + s.next + '" class="next-fieldset rev-form-button btn btn-orange " /><input type="submit" name="submit" id="submit" value="' + s.submit + '" class="rev-form-button submit-button btn btn-orange " /><div class="clear"></div></div>');
        r = n.find(".form-controls");
        f = n.find(".previous-fieldset");
        c = n.find(".next-fieldset");
        d.not(":first").hide();
        f.click(function(i) {
            if (!h()) {
                q--;
                l(q)
            }
        });
        c.click(function(w) {
            var i = h();
            if (s.validate) {
                if (n.attr("id")) {
                    p = validateForm(n.attr("id"), n)
                } else {
                    p = validateForm(n.attr("class"), n)
                }
                if (p && !i) {
                    q++;
                    l(q)
                }
            } else {
                if (!i) {
                    q++;
                    l(q)
                }
            }
        });

        function h() {
            if (!n.is(":animated")) {
                return false
            }
            return true
        }

        function l(i) {
            j = d.eq(i).outerHeight(true);
            m = r.outerHeight(true);
            v = j + m + g;
            switch (s.transition) {
                case "fade":
                    d.fadeOut(s.speed);
                    r.css("visibility", "hidden");
                    n.removeAttr("style");
                    n.animate({
                        height: v
                    }, s.speed, function() {
                        d.eq(i).fadeIn(s.speed);
                        r.css("visibility", "visible");
                        u(i);
                        n.removeAttr("style");
                        n.css("min-height", v + "px")
                    });
                    break;
                case "slide":
                    r.css("visibility", "hidden");
                    n.removeAttr("style");
                    n.animate({
                        height: v
                    }, s.speed, function() {
                        d.hide();
                        d.eq(i).show();
                        r.css("visibility", "visible");
                        u(i);
                        n.removeAttr("style");
                        n.css("min-height", v + "px")
                    });
                    break;
                default:
                    d.hide();
                    d.eq(i).show();
                    u(i)
            }
            b(i)
        }

        function u(i) {
            if (i <= 0) {
                f.hide()
            } else {
                f.show()
            }
            if (i >= o - 1) {
                c.hide();
                n.find(".submit-button").show()
            } else {
                c.show();
                n.find(".submit-button").hide()
            }
        }

        function t() {
            n.prepend('<div class="progress-bar"><span class="progress-text"></span><span class="progress-bg"></span></div>');
            $progressBar = n.find(".progress-bar");
            return $progressBar.outerHeight(true)
        }

        function b(i) {
            if (s.showProgressText) {
                n.find(".progress-text").text((i + 1) + "/" + o)
            }
            n.find(".progress-bg").animate({
                width: (k / o) * (i + 1) + "%"
            }, s.speed)
        }
        b(0)
    }
})(jQuery);
